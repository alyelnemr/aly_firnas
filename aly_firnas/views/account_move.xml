<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <record id="aly_account_journal_form_inherit" model="ir.ui.view">
            <field name="name">aly.account.journal.form.inherit.online.sync</field>
            <field name="model">account.journal</field>
            <field name="inherit_id" ref="account.view_account_journal_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='type']" position="after">
                    <field name="is_expense_module" />
                </xpath>
            </field>
        </record>

        <record id="view_move_form_currency_rate_inherit" model="ir.ui.view">
            <field name="name">view.move.form.currency.rate.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="attributes">

                    <attribute name="attrs">
                        {'required': [('type', 'in', ('in_invoice', 'out_invoice'))]}
                    </attribute>
                    <field name="analytic_tag_ids" widget="many2many_tags" required="1"
                           attrs="{'invisible': [('type', 'not in', ('entry', 'in_invoice', 'out_invoice', 'in_refund', 'in_receipt'))]}"/>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="analytic_account_id" required="1"
                           attrs="{'invisible': [('type', 'not in', ('entry', 'in_invoice', 'out_invoice', 'in_refund', 'in_receipt'))]}"/>
                    <field name="analytic_tag_ids" widget="many2many_tags" required="1"
                           attrs="{'invisible': [('type', 'not in', ('entry', 'in_invoice', 'out_invoice', 'in_refund', 'in_receipt'))]}"/>
                </xpath>
                <xpath expr="//field[@name='ref']" position="after">
                    <field name="p_order_id"
                           groups="base.group_no_one"
                           attrs="{'invisible': [('type', 'not in', ('in_invoice'))]}"/>
                    <field name="s_order_id"
                           groups="base.group_no_one"
                           attrs="{'invisible': [('type', 'not in', ('out_invoice'))]}"/>
                    <field name="purchase_order_id" invisible="1"/>
                    <field name="sale_order_id" invisible="1"/>
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button class="oe_stat_button o_res_partner_tip_opp" type="object"
                            name="action_view_purchase_order"
                            icon="fa-pencil-square-o" attrs="{'invisible': [('purchase_order_id', '=', False)]}">
                        <span>Purchase Order</span>
                    </button>
                    <button class="oe_stat_button o_res_partner_tip_opp" type="object"
                            name="action_view_sale_order"
                            icon="fa-pencil-square-o" attrs="{'invisible': [('sale_order_id', '=', False)]}">
                        <span>Sales Order</span>
                    </button>
                </xpath>
                <xpath expr="//field[@name='currency_id']" position="after">
                    <field name="is_manual" invisible="1"/>
                    <label
                            for="manual_currency"
                            groups="base.group_multi_currency"
                            attrs="{'invisible': [('is_manual', '=', False)]}"
                    />
                    <div groups="base.group_multi_currency" attrs="{'invisible': [('is_manual', '=', False)]}">
                        <field
                                name="manual_currency"
                                attrs="{'invisible': [('is_manual', '=', False)], 'readonly': [('state', '!=', 'draft')]}"
                        />
                        <field
                                name="custom_rate_conversely"
                                attrs="{'invisible': [('manual_currency', '=', False)], 'readonly': [('state', '!=', 'draft')]}"
                        />
                        <button
                                aria-label="Opened"
                                type="object"
                                name="action_refresh_currency"
                                class="btn-link"
                                states="draft"
                        >
                            <i
                                    title="Update Currency"
                                    class="fa fa-fw fa-refresh"
                                    attrs="{'invisible': [('manual_currency', '=', False)]}"
                            />
                        </button>
                    </div>
                </xpath>
                <xpath expr="//field[@name='date']" position="attributes">
                    <attribute name="attrs">{'invisible': False}</attribute>
                    <attribute name="modifiers">
                        {'invisible':False,'readonly':[['state','not
                        in',['draft']]],'required':true}</attribute>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='account_id']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="before">
                    <field name="is_printed" force_save="1"/>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='product_id']" position="before">
                    <field name="is_printed" force_save="1"/>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='partner_id']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='currency_id']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='debit']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='line_ids']/tree/field[@name='credit']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
            </field>
        </record>

        <record id="aly_view_invoice_tree_inherit" model="ir.ui.view">
            <field name="name">view.invoice.tree.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="partner_id"/>
                    <field name="note"/>
                </xpath>
                <xpath expr="//field[@name='amount_total_signed']" position="before">
                    <field name="amount_line_currency_field" invisible="1"/>
                    <field name="amount_line" widget="monetary" options="{'currency_field': 'amount_line_currency_field'}"/>
                </xpath>
                <xpath expr="//field[@name='amount_untaxed_signed']" position="after">
                    <field name="amount_currency_field" invisible="1"/>
                    <field name="amount_in_currency" widget="monetary" options="{'currency_field': 'amount_currency_field'}"/>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="analytic_account_id" optional="show"/>
                    <field name="analytic_tag_ids" widget="many2many_tags" optional="show"/>
                </xpath>
            </field>
        </record>

        <record id="aly_inherit_account_move_line_tree_view" model="ir.ui.view">
            <field name="name">account.move.line.tree.view</field>
            <field name="model">account.move.line</field>
            <field name="inherit_id" ref="account.view_move_line_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="after">
                    <field name="note"/>
                </xpath>
                <xpath expr="//field[@name='account_id']" position="after">
                    <field name="analytic_account_id" optional="show"/>
                    <field name="analytic_tag_ids" widget="many2many_tags" optional="show"/>
                </xpath>
            </field>
        </record>


        <record id="view_move_tree_inherit" model="ir.ui.view">
            <field name="name">view.move.tree.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="analytic_account_id" optional="show"/>
                    <field name="analytic_tag_ids" widget="many2many_tags" optional="show"/>
                </xpath>
            </field>
        </record>

        <template id="aly_invoice_report_footer_inherit" inherit_id="web.external_layout_standard">
            <!-- Remove footer-->
            <xpath expr="//div[@name='financial_infos']/../.." position="replace">
                <span>fofo</span>
            </xpath>
        </template>

        <template id="aly_invoice_report_inherit" inherit_id="account.report_invoice_document">
            <xpath expr="//t[@t-set='lines']" position="replace">
                <t t-set="lines" t-value="o.invoice_line_ids.filtered_domain([('is_printed', '=', True)]).sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                <t t-set="is_printed_subtotal" t-value="0"/>
                <t t-if="not var_taxed_amount">
                    <t t-set="var_taxed_amount" t-value="0"/>
                </t>
            </xpath>
            <xpath expr="//t[@t-foreach='lines']" position="inside">
                <t t-set="is_printed_subtotal" t-value="is_printed_subtotal + line.price_subtotal"/>
            </xpath>
            <xpath expr="//span[@t-field='o.amount_untaxed']" position="replace">
                <span t-esc="is_printed_subtotal"
                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                />
            </xpath>
            <xpath expr="//t[@t-set='address']" position="replace">
                <br/>
                <br/>
                <br/>
                <t t-set="address">
                    <address t-field="o.partner_id"
                             t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                </t>
            </xpath>
            <xpath expr="//span[@t-field='o.amount_total']" position="replace">
<!--                <span class="text-nowrap" t-field="o.amount_total"/>-->
                <span t-esc="is_printed_subtotal + var_taxed_amount"
                      t-options='{"widget": "monetary", "display_currency": o.currency_id}'
                />
            </xpath>
            <xpath expr="//t[@t-foreach='o.amount_by_group']" position="replace">
                <t t-set="temp_for_global_discount" t-value="0">
                </t>
                <t t-if="temp_for_global_discount == 0" >
                    <tr style="">
                        <td>
                            <span>Taxes</span>
                        </td>
                        <td class="text-right o_price_total">
                            <span class="text-nowrap" t-esc="var_taxed_amount"/>
                        </td>
                    </tr>
                </t>
            </xpath>
        </template>
    </data>
</odoo>