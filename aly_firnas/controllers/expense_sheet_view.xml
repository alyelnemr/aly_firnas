<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="display_expense_reports" name="Display Expense Reports">
            <t t-call="portal.portal_layout">
                <style>
                    #myInput {
                    background-position: 10px 10px;
                    background-repeat: no-repeat;
                    width: 100%;
                    font-size: 16px;
                    padding: 12px 20px 12px 40px;
                    border: 1px solid #ddd;
                    margin-bottom: 12px;
                    }
                    .container {
                    max-width: 100% !important;
                    }
                </style>
                <t t-set="breadcrumbs_searchbar" t-value="True"/>
                <t t-call="portal.portal_searchbar">
                    <t t-set="title">Expense Report</t>
                </t>
                <h3 class="page-header">
                    Your Expense Reports
                </h3>
                <div class="row">
                    <div class="col-sm-6">
                        <a t-attf-href="/expense_report_form" class="btn btn-info">New Expense Report</a>
                    </div>
                </div>
                <t t-if="not expenses_reports">
                    <p>You don't have any expense reports yet.</p>
                </t>
                <t t-if="expenses_reports">
                    <table class="table table-hover o_my_status_table">
                        <thead>
                            <tr class="active">
                                <th>Summary</th>
                                <th>Total</th>
                                <th>Employee</th>
                                <th>Manager</th>
                                <th>Company</th>
                                <th>Status</th>
                                <th></th>
                            </tr>
                        </thead>
                        <t t-foreach="expenses_reports" t-as="exp">
                            <tr>
                                <td class="text-left">
                                    <span t-field="exp.name"/>
                                </td>
                                <td class="text-left">
                                    <span t-field="exp.total_amount"/>
                                </td>
                                <td class="text-left">
                                    <span t-field="exp.employee_id.display_name"/>
                                </td>
                                <td class="text-left">
                                    <span t-field="exp.user_id.display_name"/>
                                </td>
                                <td class="text-left">
                                    <span t-field="exp.company_id.display_name"/>
                                </td>
                                <td class="text-left">
                                    <span t-if="exp.state in ['approved', 'done']" t-esc="report_states[exp.state]"
                                          class="badge badge-pill badge-success"/>
                                    <span t-elif="exp.state in ['draft']" t-esc="report_states[exp.state]"
                                          class="badge badge-pill badge-warning"/>
                                    <span t-elif="exp.state in ['cancel']" t-esc="report_states[exp.state]"
                                          class="badge badge-pill badge-danger"/>
                                    <span t-else="" t-esc="report_states[exp.state]"
                                          class="badge badge-pill badge-info"/>
                                </td>
                                <td>
                                    <t t-if="exp.state in ['draft']">
                                        <a class="btn btn-info"
                                           t-att-href="'/report_submit?id=%s' % (exp.id)">
                                            Submit
                                        </a>
                                    </t>
                                    <t t-if="exp.state in ['draft', 'submit']">
                                        <a class="btn btn-info"
                                           t-att-href="'/expense_report_form/%s' % (exp.id)">
                                            Edit
                                        </a>
                                    </t>
                                    <t t-if="exp.state in ['draft', 'submit']">
                                        <a class="btn btn-info"
                                           t-att-href="'/expense_report_delete/%s' % (exp.id)">
                                            Delete <t t-esc="exp.state" />
                                        </a>
                                    </t>
                                    <t t-if="exp.state in ['submit']">
                                        <a t-if="request.env['res.users'].browse(request.session.uid).user_has_groups('aly_firnas.group_employee_expense_manager_portal')" class="btn btn-success"
                                           t-att-href="'/report_approve?id=%s' % (exp.id)">
                                            Approve
                                        </a>
                                        <a t-if="request.env['res.users'].browse(request.session.uid).user_has_groups('aly_firnas.group_employee_expense_manager_portal')" class="btn btn-danger"
                                           t-att-href="'/report_refuse?id=%s' % (exp.id)">
                                            Refuse
                                        </a>
                                    </t>
                                </td>
                            </tr>
                        </t>
                    </table>
                    <div t-if="pager" class="o_portal_pager text-center">
                        <t t-call="portal.pager"/>
                    </div>
                </t>
            </t>
        </template>

        <template id="display_expense_report" name="Portal: My Expense Report">
            <t t-call="portal.portal_layout">
                <div class="container">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-lg-12 text-center">
                                    <h4>
                                        <span t-esc="expense_report.name"/>
                                    </h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row" style="margin-bottom: 10px;">
                                <div class="col-lg-6">
                                    <t t-if="expense_report.state in ['draft']">
                                        <a class="btn btn-info"
                                           t-att-href="'/report_submit?id=%s&amp;form=1' % (expense_report.id)">
                                            Submit
                                        </a>
                                    </t>
                                    <t t-if="expense_report.state in ['draft']">
                                        <a class="btn btn-info"
                                           t-att-href="'/expense_report_form/%s' % (expense_report.id)">
                                            Edit
                                        </a>
                                    </t>
                                    <t t-if="expense_report.state in ['reported']">
                                        <a id="approve" t-if="request.env['res.users'].browse(request.session.uid).user_has_groups('aly_firnas.group_employee_expense_manager_portal')" class="btn btn-success"
                                           t-att-href="'/request_approve?id=%s&amp;form=1' % (expense_report.id)">
                                            Approve
                                        </a>
                                        <a id="refuse" t-if="request.env['res.users'].browse(request.session.uid).user_has_groups('aly_firnas.group_employee_expense_manager_portal')" class="btn btn-danger"
                                           t-att-href="'/request_refuse?id=%s&amp;form=1' % (expense_report.id)">
                                            Refuse
                                        </a>
                                    </t>
                                </div>
                                <div class="col-lg-6 text-right">
                                    <span t-if="expense_report.state in ['approved', 'done']"
                                          t-esc="report_states[expense_report.state]"
                                          class="badge badge-pill badge-success"/>
                                    <span t-elif="expense_report.state in ['cancel']"
                                          t-esc="report_states[expense_report.state]"
                                          class="badge badge-pill badge-danger"/>
                                    <span t-elif="expense_report.state in ['draft']"
                                          t-esc="report_states[expense_report.state]"
                                          class="badge badge-pill badge-warning"/>
                                    <span t-else="" t-esc="report_states[expense_report.state]"
                                          class="badge badge-pill badge-info"/>
                                </div>
                            </div>
                            <div class="mb8">
                                <strong>Employee:</strong>
                                <span t-field="expense_report.employee_id.display_name"/>
                            </div>
                            <div class="mb8">
                                <strong>Manager:</strong>
                                <span t-field="expense_report.user_id.name"/>
                            </div>
                            <div class="mb8">
                                <strong>Paid By:</strong>
                                <span t-esc="payment_modes[expense_report.payment_mode]"/>
                            </div>
                            <hr/>
                            <div class="row">
                                <div class="col-lg-2 text-left">
                                    <strong>Date</strong>
                                </div>
                                <div class="col-lg-3">
                                    <strong>Product</strong>
                                </div>
                                <div class="col-lg-2 text-right">
                                    <strong>Unit Price</strong>
                                </div>
                                <div class="col-lg-2 text-right">
                                    <strong>Quantity</strong>
                                </div>
                                <div class="col-lg-2 text-right">
                                    <strong>Subtotal</strong>
                                </div>
                            </div>
                            <t t-foreach="expense_report.expense_line_ids" t-as="expense_request">
                                <div class="row">
                                    <div class="col-lg-2 text-left">
                                        <span t-field="expense_request.date" t-options='{"widget": "date"}'/>
                                    </div>
                                    <div id='product_name' class="col-lg-3">
                                        <span t-esc="expense_request.product_id.name"/>
                                    </div>
                                    <div class="col-lg-2 text-right">
                                        <span t-field="expense_request.unit_amount"
                                              t-options='{"widget": "monetary", "display_currency": expense_request.currency_id}'/>
                                    </div>
                                    <div class="col-lg-2 text-right">
                                        <span t-esc="expense_request.quantity"/>
                                    </div>
                                    <div class="col-lg-2 text-right">
                                        <span t-field="expense_request.untaxed_amount"
                                              t-options='{"widget": "monetary", "display_currency": expense_request.currency_id}'/>
                                    </div>
                                </div>
                            </t>
                            <hr style="width: 70%"/>
                            <div class="row">
                                <div class="col-lg-12 text-right">
                                    <div class="row">
                                        <div class="col-lg-10 text-right">
                                            <strong>Total:</strong>
                                        </div>
                                        <div class="col-lg-2 text-right">
                                            <strong>
                                                <span t-field="expense_report.total_amount"
                                                      t-options='{"widget": "monetary", "display_currency": expense_report.currency_id}'/>
                                            </strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr/>
                        </div>
                    </div>
                </div>
                <div class="oe_structure mb32"/>
            </t>
        </template>
    </data>
</odoo>

