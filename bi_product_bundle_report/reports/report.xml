<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <template id="sale_management.report_saleorder_document_inherit_sale_management"
                  inherit_id="sale.report_saleorder_document">
            <xpath expr="//div[@name='signature']" position="after">
                <div t-if="doc.sale_order_option_ids and doc.state in ['draft', 'sent']">
                    <t t-set="has_option_discount"
                       t-value="any(doc.sale_order_option_ids.filtered(lambda o: o.discount != 0.0))"/>
                    <h4>
                        <span>Options</span>
                    </h4>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th class="text-left">Item</th>
                                <th class="text-left">Description</th>
                                <th class="text-left">Qty</th>
                                <th t-if="has_option_discount" groups="product.group_discount_per_so_line" class="text-left">
                                    Disc.%
                                </th>
                                <th class="text-right">Unit Price</th>
                            </tr>
                        </thead>
                        <tbody class="sale_tbody">
                            <tr t-foreach="doc.sale_order_option_ids" t-as="option">
                                <td>
                                    <span t-field="option.product_id.name"/>
                                </td>
                                <td>
                                    <span t-field="option.name"/>
                                </td>
                                <td>
                                    <span t-field="option.quantity"/>
                                </td>
                                <td t-if="has_option_discount" groups="product.group_discount_per_so_line">
                                    <strong t-if="option.discount != 0.0" class="text-info">
                                        <t t-esc="((option.discount % 1) and '%s' or '%d') % option.discount"/>
                                        %
                                    </strong>
                                </td>
                                <td>
                                    <strong class="text-right">
                                        <div t-field="option.price_unit"
                                             t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'
                                             t-att-style="option.discount and 'text-decoration: line-through' or None"
                                             t-att-class="option.discount and 'text-danger' or None"/>
                                        <div t-if="option.discount">
                                            <t t-esc="'%.2f' % ((1-option.discount / 100.0) * option.price_unit)"/>
                                        </div>
                                    </strong>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </xpath>

        </template>

        <template id="external_layout_standard_new" inherit_id="web.external_layout_standard" primary="True">
            <xpath expr="//div[@class='header']" position="replace">

                <div t-attf-class="header" style="height: 100px !important; z-index:0 !important;">
                    <div class="row" style="margin: 0 auto; padding-top: 10px; height: 100px !important; width: 90%;">
                        <div class="col-4 mb4 text-left">
                            <img src="/bi_product_bundle_report/static/src/img/firnas_logo_full.jpg"
                                 style="height: 90px !important;" alt="Logo"/>
                        </div>
                        <div class="col-8 text-right" style="justify-content: center; padding: 15px 0px 15px 0px !important;">
                            <div style="width: 90% !important; border-right: 1px solid black; padding-right: 4px; display: inline-block !important;">
                                <span style="font-family: verdana !important; font-size: 15px;" t-esc="doc.project_name"/>
                                <br/>
                                <span style="font-family: verdana !important; font-size: 15px;" t-esc="doc.document_name"/>
                            </div>
                            <div class="page_number d-inline-block"
                                 style="width: 6% !important; height: 100px !important; vertical-align:top;">
                                <div style="font-family: verdana !important; font-size: 15px !important;">4-<span class="page"
                                          style="padding-right: 5px !important; font-family: verdana !important; font-size: 15px !important; margin-left: -1px;"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
            <xpath expr="//div[contains(@t-attf-class, 'footer')]" position="replace">
                <div t-attf-class="footer">

                    <div class="row" style="width: 100% !important; margin: auto auto; padding-top: 35px;">
                        <br/>
                        <div class="text-left" style="width: 100%;">
                            <h5 style="font-family: verdana !important; font-size: 15px;color:rgb(166, 166, 166);">
                                <t t-esc="doc.file_name"/>
                            </h5>
                        </div>
                    </div>
                </div>
            </xpath>

        </template>


        <template id="external_layout_new">
            <t t-if="not o" t-set="o" t-value="doc"/>

            <t t-if="not company">
                <!-- Multicompany -->
                <t t-if="company_id">
                    <t t-set="company" t-value="company_id"/>
                </t>
                <t t-elif="o and 'company_id' in o">
                    <t t-set="company" t-value="o.company_id.sudo()"/>
                </t>
                <t t-else="else">
                    <t t-set="company" t-value="res_company"/>
                </t>
            </t>

            <t t-call="bi_product_bundle_report.external_layout_standard_new">
                <t t-raw="0"/>
            </t>
        </template>

    </data>
    <data>

        <template id="report_assets_common_custom_fonts" name="Custom QWeb fonts" inherit_id="web.report_assets_common">
            <xpath expr="." position="inside">
                <link href="/bi_product_bundle_report/static/src/scss/fonts.scss" rel="stylesheet" type="text/less"/>
            </xpath>
        </template>


        <template id="sub_line_sub__sub_bundle_template">
            <t t-foreach="sub_line_1['sub_lines']" t-as="sub_line_2">
                <tr style="font-size:10px !important; font-family: verdana !important;">
                    <td class="text-left" colspan="2" style="font-family: verdana !important;"/>
                    <td class="text-left" style="padding-left: 60px; font-family: verdana !important;">
                        <t t-esc="sub_line_2['name']" style="font-family: verdana !important;"/>
                    </td>
                    <td class="text-left" style="font-size:10px !important; font-family: verdana !important;">
                        <t t-esc="sub_line_2['desc']" style="font-family: verdana !important;"/>
                    </td>
                    <td class="text-center" style="font-family: verdana !important;">
                        <t t-esc="sub_line_2['qty']" style="font-family: verdana !important;"/>
                    </td>
                    <td class="text-left" style="font-family: verdana !important;">
                        <t t-if="sub_line_2['show_price']">
                            <span t-esc="sub_line_2['total_price']/sub_line_2['qty']" style="font-family: verdana !important;"
                                  t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                        </t>
                    </td>
                    <td class="text-right" style="font-family: verdana !important;">
                        <t t-if="sub_line_2['show_price']">
                            <span t-esc="sub_line_2['total_price']" style="font-family: verdana !important;"
                                  t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                        </t>
                    </td>
                </tr>
            </t>
        </template>

        <template id="sub_line_sub_bundle_template">
            <tr style="font-size:10px !important; font-family: verdana !important;">
                <td class="text-left" colspan="2" style="font-family: verdana !important;"/>
                <td class="text-left" style="padding-left: 60px; font-family: verdana !important;">
                    -
                    <t t-raw="sub_line_1['desc']" style="font-family: verdana !important;"/>
                </td>
                <td class="text-center" style="font-family: verdana !important;">
                    <t t-esc="sub_line_1['qty']" style="font-family: verdana !important;"/>
                </td>
                <td class="text-left" style="font-family: verdana !important;">
                    <t t-if="sub_line_1['show_price']">
                        <span t-esc="sub_line_1['total_price']/sub_line_1['qty']" style="font-family: verdana !important;"
                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                    </t>
                </td>
                <t t-if="is_discounted">
                    <td class="text-right" style="font-family: verdana !important;">
                    </td>
                </t>
                <t t-if="is_taxed">
                    <td class="text-right" style="font-family: verdana !important;">
                    </td>
                </t>
                <td class="text-right" style="font-family: verdana !important;">
                    <t t-if="sub_line_1['show_price']">
                        <span t-esc="sub_line_1['total_price']" style="font-family: verdana !important;"
                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                    </t>
                </td>
            </tr>

            <t t-foreach="sub_line_1['sub_lines']" t-as="sub_line_2">
                <t t-call="bi_product_bundle_report.sub_line_sub__sub_bundle_template"/>
            </t>
        </template>
        <template id="sub_line_template">

            <tr style="font-size:10px !important; font-family: verdana !important; width: 30px !important;">
                <td class="text-left" colspan="2" style="font-family: verdana !important;"/>
                <td class="text-left" style="font-size:10px !important; font-family: verdana !important;">
                    <t t-raw="sub_line['desc']" style="padding-left: 30px; font-family: verdana !important;"/>
                </td>
                <td class="text-center" style="font-family: verdana !important;">
                    <t t-esc="sub_line['qty']" style="font-family: verdana !important;"/>
                </td>
                <td class="text-left" style="font-family: verdana !important;">
                    <t t-if="sub_line['show_price']">
                        <span t-esc="sub_line['total_price']/sub_line['qty']" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                    </t>
                </td>
                <t t-if="is_discounted">
                    <td class="text-right" style="font-family: verdana !important;">
                    </td>
                </t>
                <t t-if="is_taxed">
                    <td class="text-right" style="font-family: verdana !important;">
                    </td>
                </t>
                <td class="text-right" style="font-family: verdana !important;">
                    <t t-if="sub_line['show_price']">
                        <span t-esc="sub_line['total_price']" style="font-family: verdana !important;"
                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                    </t>
                </td>
            </tr>
            <t t-foreach="sub_line['sub_lines']" t-as="sub_line_1">
                <t t-call="bi_product_bundle_report.sub_line_sub_bundle_template"/>
            </t>


        </template>
        <template id="report_bundled_saleorder_document">
            <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
            <div class="page" style="z-index:1000 !important;padding-top: 10px; ">
                <div class="oe_structure"/>
                <t t-set="display_discount" t-value="0"/>

                <!-- Financial Proposal 4 -->
                <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 10px;">
                    <div class="text-left" style="display: flex; align-items: center; justify-content: center;">
                        <div>
                            <h4 style="color:rgb(86, 56, 90); font-size: 22px !important; font-weight: bold; font-family: verdana !important;">
                                4 Financial Proposal
                            </h4>
                        </div>
                    </div>
                </div>
                <br/>

                <!-- Proposed Prices 4.1 -->
                <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 0px; padding-bottom: 15px !important;">
                    <div class="text-left" style="display: flex; align-items: center; justify-content: center;">
                        <div>
                            <h5 style="color:rgb(86, 56, 90); font-size: 17px !important; font-weight: bold; font-family: verdana !important;">
                                4.1 Proposed Prices
                            </h5>
                        </div>
                        <table class="table table-sm o_main_table" style="margin: 0 auto;">
                            <thead>
                                <tr style="font-family: verdana !important;">
                                    <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:500px;font-size: 11px;" colspan="3">
                                        Description</th>
                                    <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:40px; font-size: 11px;">Qty</th>
                                    <th class="text-right" style="font-family: verdana !important;color: #D8BFD8; width:70px; font-size: 11px;">Unit Price</th>
                                    <t t-if="is_discounted">
                                        <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:70px; font-size: 11px;">Discount</th>
                                    </t>
                                    <t t-if="is_taxed">
                                        <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:70px; font-size: 11px;">Taxes</th>
                                    </t>
                                    <th class="text-right" style="font-family: verdana !important;color: #D8BFD8; width:70px; font-size: 11px;">Total Price</th>
                                </tr>
                            </thead>
                            <!-- sections and products -->
                            <tbody class="sale_tbody">
                                <t t-set="sections" t-value="doc.print_bundled_quotation()"/>
                                <t t-set="bundle_index" t-value="1"/>
                                <t t-foreach="sections" t-as="section">
                                    <tr t-att-class="'bg-200 font-weight-bold o_line_section'" style="font-size:10px !important; font-family: verdana !important;">
                                        <td class="text-left" style="width: 30px !important; font-family: verdana !important;">
                                            <t t-esc="bundle_index"/>.</td>
                                        <t t-if="col_span == 5">
                                            <td class="text-left" colspan="5" style="font-family: verdana !important;">
                                                <t t-esc="sections[section]['name']"
                                                   style="font-family: verdana !important;"/>
                                            </td>
                                        </t>
                                        <t t-if="col_span == 6">
                                            <td class="text-left" colspan="6" style="font-family: verdana !important;">
                                                <t t-esc="sections[section]['name']"
                                                   style="font-family: verdana !important;"/>
                                            </td>
                                        </t>
                                        <t t-if="col_span == 4">
                                            <td class="text-left" colspan="4" style="font-family: verdana !important;">
                                                <t t-esc="sections[section]['name']"
                                                   style="font-family: verdana !important;"/>
                                            </td>
                                        </t>
                                        <td class="text-right">
                                            <span t-esc="sections[section]['total_price']" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                        </td>
                                    </tr>
                                    <t t-set="bundle_sub_index" t-value="1"/>
                                    <t t-foreach="sections[section]['lines']" t-as="line">
                                        <tr t-att-class="'font-weight-bold'" style="font-size:10px !important; font-family: verdana !important;">
                                            <td class="text-left" colspan="2" style="width: 30px !important;white-space: nowrap;">
                                                <t t-esc="str(bundle_index) + '.' + str(bundle_sub_index)" style="padding-left: 0px; font-family: verdana !important;"/>
                                            </td>
                                            <td class="text-left" style="padding-left: 15px; font-family: verdana !important;">
                                                <t t-raw="line['desc']" style="font-family: verdana !important;"/>
                                            </td>
                                            <td class="text-center" style="font-family: verdana !important;">
                                                <t t-esc="line['qty']" style="font-family: verdana !important;"/>
                                            </td>
                                            <td class="text-right" style="font-family: verdana !important;">
                                                <span t-esc="line['price_unit']" style="font-family: verdana !important;"
                                                      t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                            </td>
                                            <t t-if="is_discounted">
                                                <td class="text-center" style="font-family: verdana !important;">
                                                    <t t-if="line['discount'] > 0">
                                                        <span t-esc="line['discount']" style="font-family: verdana !important;"/>
                                                    </t>
                                                </td>
                                            </t>
                                            <t t-if="is_taxed">
                                                <td class="text-center" style="font-family: verdana !important;">
                                                    <span t-esc="', '.join(map(lambda x: (x.description or x.name), line['tax_id']))"/>
                                                </td>
                                            </t>
                                            <td class="text-right" style="font-family: verdana !important;">
                                                <span t-esc="line['total_price']" style="font-family: verdana !important;"
                                                      t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                            </td>
                                        </tr>
                                        <t t-set="bundle_sub_index" t-value="bundle_sub_index+1"/>

                                        <t t-foreach="line['sub_lines']" t-as="sub_line">
                                            <t t-call="bi_product_bundle_report.sub_line_template"/>
                                        </t>
                                    </t>
                                    <t t-set="bundle_index" t-value="bundle_index + 1"/>
                                </t>
                            </tbody>

                        </table>
                    </div>
                </div>

                <div class="clearfix" name="so_total_summary" style="padding-right: 8% !important;">
                    <div id="total" class="row" name="total">
                        <div t-attf-class="#{'col-4' if report_type != 'html' else 'col-sm-7 col-md-5'} ml-auto">
                            <table class="table table-sm">
                                <tr class="border-black o_subtotal" style="font-family: verdana !important; font-size: 11px !important;">
                                    <td name="td_amount_untaxed_label" style="font-family: verdana !important;">
                                        <strong style="font-family: verdana !important;">Subtotal</strong>
                                    </td>
                                    <td name="td_amount_untaxed" style="font-family: verdana !important;" class="text-right">
                                        <span t-esc="amount_untaxed" style="font-family: verdana !important;"
                                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                                <tr style="font-family: verdana !important; font-size: 11px !important;">
                                    <td name="td_amount_by_group_label" style="font-family: verdana !important;">
                                        <strong style="font-family: verdana !important;">Taxes</strong>
                                    </td>
                                    <td name="td_amount_by_group" class="text-right o_price_total"
                                        style="font-family: verdana !important;">
                                        <span t-esc="amount_tax" style="font-family: verdana !important;"
                                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
<!--                                <t t-foreach="doc.amount_by_group" t-as="amount_by_group">-->
<!--                                    <tr style="font-family: verdana !important; font-size: 11px !important;">-->
<!--                                        <t t-if="amount_by_group[3] == 1 and doc.amount_untaxed == amount_by_group[2]">-->
<!--                                            <td name="td_amount_by_group_label_3" style="font-family: verdana !important;">-->
<!--                                                <span t-esc="amount_by_group[0]"/>-->
<!--                                                <span style="font-family: verdana !important;">&amp;nbsp;<span>on</span>&amp;nbsp;-->
<!--                                                    <t t-esc="amount_by_group[2]" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>-->
<!--                                                </span>-->
<!--                                            </td>-->
<!--                                            <td name="td_amount_by_group_3" style="font-family: verdana !important;" class="text-right o_price_total">-->
<!--                                                <span t-esc="amount_by_group[1]" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>-->
<!--                                            </td>-->
<!--                                        </t>-->
<!--                                        <t t-else="">-->
<!--                                            <td name="td_amount_by_group_label" style="font-family: verdana !important;">-->
<!--                                                <span style="font-family: verdana !important;">Taxes</span>-->
<!--                                            </td>-->
<!--                                            <td name="td_amount_by_group" class="text-right o_price_total" style="font-family: verdana !important;">-->
<!--                                                <span t-esc="docs.amount_tax" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>-->
<!--                                            </td>-->
<!--                                        </t>-->
<!--                                    </tr>-->
<!--                                </t>-->
                                <tr style="font-family: verdana !important; font-size: 11px !important;" t-if="env['res.config.settings'].sudo().get_values()['ks_enable_discount'] and doc.ks_amount_discount > 0">
                                    <td name="global_discount_amount_label" style="font-family: verdana !important;">
                                        <strong style="font-family: verdana !important;">Global Discount</strong>
                                    </td>
                                    <td name="global_discount_amount" style="font-family: verdana !important;" class="text-right">
                                        <span t-field="doc.ks_amount_discount" style="font-family: verdana !important;"/>
                                    </td>
                                </tr>
                                <tr class="border-black o_total" style="font-family: verdana !important; font-size: 11px !important;">
                                    <td name="td_amount_total_label" style="font-family: verdana !important;">
                                        <strong style="font-family: verdana !important;">Total</strong>
                                    </td>
                                    <td name="td_amount_total" class="text-right" style="font-family: verdana !important;">
                                        <span style="font-family: verdana !important;" t-esc="amount_total"
                                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <br/>
                <t t-set="header_index" t-value="2"/>

                <p t-if="doc.split_page" style="page-break-after:always;"/>

                <!-- Additional Products 4.2 -->
                <t t-if="doc.sale_order_additional_ids">
                    <t t-if="is_additional_exists">
                        <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 0px; font-family: verdana !important;">
                            <div class="text-left" style="display: flex; align-items: center; justify-content: center; font-family: verdana !important;">
                                <div>
                                    <h5 style="color:rgb(86, 56, 90); font-size: 17px !important; font-weight: bold; font-family: verdana !important;">
                                        4.<t t-esc="header_index"/>
                                        Additional Services Fees
                                    </h5>
                                </div>
                                <t t-set="has_additional_discount" t-value="any(doc.sale_order_additional_ids.filtered(lambda o: o.discount != 0.0))"/>
                                <table class="table table-sm o_main_table" style="margin: 0 auto; font-family: verdana !important;">
                                    <thead>
                                        <tr style="font-family: verdana !important;">
                                            <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:500px !important; font-size: 11px;" colspan="2">Description</th>
                                            <th class="text-left" style="font-family: verdana !important;color: #D8BFD8; width:40px !important; font-size: 11px;">Qty</th>
                                            <th class="text-left" style="font-family: verdana !important;color: #D8BFD8; width:70px !important; font-size: 11px; width: 90px;">Price Note</th>
                                            <th t-if="has_option_discount" groups="product.group_discount_per_so_line" class="text-left" style="width:20px !important;color: #D8BFD8; font-size: 11px; font-family: verdana !important;">Disc.%
                                            </th>
                                            <th class="text-right" style="width:70px !important;color: #D8BFD8; font-size: 11px; font-family: verdana !important;">Unit Price</th>
                                            <th class="text-right" style="width:70px !important;color: #D8BFD8; font-size: 11px; font-family: verdana !important;">Total Price</th>
                                        </tr>
                                    </thead>
                                    <t t-set="bundle_index" t-value="1"/>
                                    <tbody class="sale_tbody">
                                        <t t-set="sections_additional" t-value="doc.get_additional_lines()"/>
                                        <t t-foreach="sections_additional" t-as="section">
                                            <tr t-att-class="'bg-200 font-weight-bold o_line_section'" style="font-size:10px !important; font-family: verdana !important;">
                                                <td class="text-left" style="width: 30px !important; font-family: verdana !important;">
                                                    <t t-esc="bundle_index" style="font-family: verdana !important;"/>.
                                                </td>
                                                <td class="text-left" t-if="has_option_discount" colspan="7" style="font-family: verdana !important;">
                                                    <t t-esc="sections_additional[section]['name']" style="font-family: verdana !important;"/>
                                                </td>
                                                <td class="text-left" t-if="not has_option_discount" colspan="6" style="font-family: verdana !important;">
                                                    <t t-esc="sections_additional[section]['name']" style="font-family: verdana !important;"/>
                                                </td>
                                            </tr>
                                            <t t-set="bundle_sub_index" t-value="1"/>
                                            <t t-foreach="sections_additional[section]['lines']" t-as="line">
                                                <tr t-att-class="'font-weight-bold'" style="font-size:10px !important; font-family: verdana !important; width: 30px !important;">
                                                    <td class="text-left" style="font-family: verdana !important;width: 10px;">
                                                        <t t-esc="str(bundle_index) + '.' + str(bundle_sub_index)" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-left" style="padding-left: 15px; font-family: verdana !important;">
                                                        <t t-raw="line['desc']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-center" style="font-family: verdana !important;">
                                                        <t t-esc="line['qty']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td t-if="has_option_discount" style="font-family: verdana !important;" groups="product.group_discount_per_so_line" class="text-center">
                                                        <t t-esc="line['disc']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-left" style="font-family: verdana !important;">
                                                        <t t-esc="line['price_note']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-right" style="font-family: verdana !important;">
                                                        <span t-esc="line['price_unit']" style="font-family: verdana !important;"
                                                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td>
                                                    <td class="text-right" style="font-family: verdana !important;">
                                                        <span t-esc="line['total_price']" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td>
                                                </tr>
                                                <t t-set="bundle_sub_index" t-value="bundle_sub_index+1"/>
                                            </t>
                                            <t t-set="bundle_index" t-value="bundle_index + 1"/>
                                        </t>
                                    </tbody>
                                </table>

                            </div>
                        </div>
                        <br/>
                        <t t-set="header_index" t-value="header_index + 1"/>
                    </t>
                </t>

                <!-- Optional Products 4.3 -->
                <t t-if="doc.sale_order_option_ids">
                    <t t-if="is_optional_exists">
                        <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 0px;">
                            <div class="text-left" style="display: flex; align-items: center; justify-content: center;">
                                <div>
                                    <h5 style="color:rgb(86, 56, 90); font-size: 17px !important; font-weight: bold; font-family: verdana !important;">
                                        4.<t t-esc="header_index" style="font-family: verdana !important;"/>
                                        Optional Services Fees
                                    </h5>
                                </div>
                                <t t-set="has_option_discount" style="font-family: verdana !important;" t-value="any(doc.sale_order_option_ids.filtered(lambda o: o.discount != 0.0))"/>
                                <table class="table table-sm o_main_table" style="width: 100% !important; font-family: verdana !important;">
                                    <thead>
                                        <tr style="font-family: verdana !important;">
                                            <th class="text-center" style="font-family: verdana !important;color: #D8BFD8; width:500px !important; font-size: 11px;" colspan="2">Description</th>
                                            <th class="text-left" style="font-family: verdana !important;color: #D8BFD8; width:40px !important; font-size: 11px;">Qty</th>
                                            <th class="text-left" style="font-family: verdana !important;color: #D8BFD8; width:70px !important; font-size: 11px; width: 90px;">Price Note</th>
                                            <th t-if="has_option_discount" groups="product.group_discount_per_so_line" class="text-left" style="font-family: verdana !important;color: #D8BFD8; width:20px !important; font-size: 11px;">Disc.%
                                            </th>
                                            <th class="text-right" style="font-family: verdana !important;color: #D8BFD8; width:70px !important; font-size: 11px;">Unit Price</th>
                                            <th class="text-right" style="font-family: verdana !important;color: #D8BFD8; width:70px !important; font-size: 11px;">Total Price</th>
                                        </tr>
                                    </thead>
                                    <t t-set="bundle_index" t-value="1"/>
                                    <tbody class="sale_tbody">
                                        <t t-set="sections_additional" t-value="doc.get_optional_lines()"/>
                                        <t t-foreach="sections_additional" t-as="section">
                                            <tr t-att-class="'bg-200 font-weight-bold o_line_section'" style="font-size:10px !important; font-family: verdana !important;">
                                                <td class="text-left" style="width: 30px !important; font-family: verdana !important;">
                                                    <t t-esc="bundle_index" style="font-family: verdana !important;"/>.
                                                </td>
                                                <td class="text-left" t-if="has_option_discount" style="font-family: verdana !important;" colspan="7">
                                                    <t t-esc="sections_additional[section]['name']" style="font-family: verdana !important;"/>
                                                </td>
                                                <td class="text-left" t-if="not has_option_discount" style="font-family: verdana !important;" colspan="6">
                                                    <t t-esc="sections_additional[section]['name']" style="font-family: verdana !important;"/>
                                                </td>
                                            </tr>
                                            <t t-set="bundle_sub_index" t-value="1"/>
                                            <t t-foreach="sections_additional[section]['lines']" t-as="line">
                                                <tr t-att-class="'font-weight-bold'" style="font-size:10px !important; font-family: verdana !important; width: 30px !important;">
                                                    <td class="text-left" style="font-family: verdana !important;width: 12px;">
                                                        <t t-esc="str(bundle_index) + '.' + str(bundle_sub_index)" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-left" style="padding-left: 15px; font-family: verdana !important;">
                                                        <t t-raw="line['desc']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-center" style="font-family: verdana !important;">
                                                        <t t-esc="line['qty']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-left" style="font-family: verdana !important;">
                                                        <t t-raw="line['price_note']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td t-if="has_option_discount" style="font-family: verdana !important;" groups="product.group_discount_per_so_line" class="text-center">
                                                        <t t-esc="line['disc']" style="font-family: verdana !important;"/>
                                                    </td>
                                                    <td class="text-right" style="font-family: verdana !important;">
                                                        <span t-esc="line['price_unit']" style="font-family: verdana !important;"
                                                              t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td>
                                                    <td class="text-right" style="font-family: verdana !important;">
                                                        <span t-esc="line['total_price']" style="font-family: verdana !important;" t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'/>
                                                    </td>
                                                </tr>
                                                <t t-set="bundle_sub_index" t-value="bundle_sub_index+1"/>
                                            </t>
                                            <t t-set="bundle_index" t-value="bundle_index + 1"/>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <br/>
                        <t t-set="header_index" t-value="header_index + 1"/>
                    </t>
                </t>

                <!-- Payment Schedule 4.4 -->
                <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 0px; page-break-inside: avoid; font-family: verdana !important;">
                    <div class="text-left">
                        <div>
                            <h5 style="color:rgb(86, 56, 90); font-size: 17px !important; font-weight: bold; font-family: verdana !important;">
                                4.<t t-esc="header_index" style="font-family: verdana !important;"/>
                                Payment Schedule
                            </h5>
                        </div>
                        <div>
                            <p style="font-size: 10px !important; font-family: verdana !important;">
                                <t t-raw="doc.standard_payment_schedule" style="font-family: verdana !important; font-size: 10px !important;"/>
                                <br/>
                                <t t-if="doc.payment_term_id.note" t-raw="doc.payment_term_id.note" style="font-family: verdana !important; font-size: 10px !important;"/>
                            </p>
                        </div>
                    </div>
                </div>
                <br/>
                <t t-set="header_index" t-value="header_index + 1"/>


                <!-- Terms And Conditions 4.5 -->
                <div class="row" style="width: 83% !important; margin: 0 auto; padding-top: 0px; page-break-inside: avoid; font-family: verdana !important;">
                    <div class="text-left">
                        <div>
                            <h5 style="color:rgb(86, 56, 90); font-size: 17px !important; font-weight: bold; font-family: verdana !important;">
                                4.<t t-esc="header_index" style="font-family: verdana !important;"/>
                                Terms and Conditions
                            </h5>
                        </div>
                        <div>
                            <p style="font-size: 10px !important; font-family: verdana !important;">
                                <t t-raw="doc.terms_and_conditions" style="font-family: verdana !important; font-size: 10px !important;"/>
                            </p>
                        </div>
                    </div>
                </div>
                <br/>



                <!-- Is there a discount on at least one line? -->
                <div t-if="doc.signature" class="mt32 ml64 mr4" name="signature" style="font-family: verdana !important;">
                    <div class="offset-8" style="font-family: verdana !important;">
                        <strong style="font-family: verdana !important;">Signature</strong>
                    </div>
                    <div class="offset-8">
                        <img t-att-src="image_data_uri(doc.signature)" style="max-height: 4cm; max-width: 8cm; font-family: verdana !important;"/>
                    </div>
                    <div class="offset-8 text-center" style="font-family: verdana !important;">
                        <p t-field="doc.signed_by" style="font-family: verdana !important;"/>
                    </div>
                </div>

                <div class="oe_structure"/>

                <p t-field="doc.note" style="font-family: verdana !important;"/>

                <p id="fiscal_position_remark" style="font-family: verdana !important;" t-if="doc.fiscal_position_id and doc.fiscal_position_id.sudo().note">
                    <strong style="font-family: verdana !important;">Fiscal Position Remark:</strong>
                    <span style="font-family: verdana !important;" t-field="doc.fiscal_position_id.sudo().note"/>
                </p>
            </div>
        </template>

        <template id="report_bundled_saleorder">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <div t-attf-class="header" style="height: 80px !important; z-index:0 !important;">
                        <div class="row" style="margin: 0 auto; padding-top: 10px; height: 80px !important; width: 90%;">
                            <div class="col-4 mb4 text-left">
                                <img src="/bi_product_bundle_report/static/src/img/firnas_logo_full.jpg"
                                     style="height: 80px !important;" alt="Logo"/>
                            </div>
                            <div class="col-8 text-right" style="justify-content: center; padding: 15px 0px 15px 0px !important;">
                                <div style="width: 90% !important; border-right: 1px solid black; padding-right: 4px; display: inline-block !important;">
                                    <span style="font-family: verdana !important; font-size: 15px;" t-esc="doc.project_name"/>
                                    <br/>
                                    <span style="font-family: verdana !important; font-size: 15px;" t-esc="doc.document_name"/>
                                </div>
                                <div class="page_number d-inline-block text-right"
                                     style="width: 6% !important; padding-right: 0px; padding-left: 0px; height: 80px !important; vertical-align:top;">
                                    <div style="font-family: verdana !important; font-size: 14px !important;">4-<span class="page"
                                              style="!important; font-family: verdana !important; font-size: 14px !important; margin-left: -1px;"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <t t-call="web.internal_layout">
                        <t t-call="bi_product_bundle_report.report_bundled_saleorder_document" t-lang="doc.partner_id.lang"/>
                    </t>
                    <div t-attf-class="footer">

                        <div class="row" style="width: 100% !important; margin: auto auto; padding-top: 35px;">
                            <br/>
                            <div class="text-left" style="width: 100%;">
                                <h5 style="font-family: verdana !important; font-size: 15px;color:rgb(166, 166, 166);">
                                    <t t-esc="doc.file_name"/>
                                </h5>
                            </div>
                        </div>
                    </div>
                </t>
            </t>
        </template>

        <record id="action_report_bundled_saleorder" model="ir.actions.report">
            <field name="name">Bundled Quotation / Order</field>
            <field name="model">sale.order</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">bi_product_bundle_report.report_bundled_saleorder</field>
            <field name="report_file">bi_product_bundle_report.report_bundled_saleorder</field>
            <field name="print_report_name">(object.state in ('draft', 'sent') and 'Quotation - %s' % (object.name)) or 'Order - %s' % (object.name)</field>
            <field name="binding_type">report</field>
        </record>
    </data>
</odoo>
